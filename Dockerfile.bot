# Telegram Bot - Lightweight image
FROM python:3.11-slim

WORKDIR /app

# Create non-root user
RUN useradd --create-home --shell /bin/bash appuser

# Copy project files
COPY pyproject.toml README.md ./
COPY src/ ./src/

# Install dependencies (only what's needed for the bot)
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir .

# Set ownership
RUN chown -R appuser:appuser /app

# Switch to non-root user
USER appuser

# Environment variables
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV APP_ENV=production

# No health check needed - bot uses long polling
# No port exposed - bot pulls from Telegram API

# Run the bot
CMD ["python", "-m", "src.telegram.bot"]
